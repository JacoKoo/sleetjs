var Context,Predict,Tag;Tag=require("./tags/tag").Tag,Predict=require("./tags/predict").Predict,exports.Context=Context=function(){function t(t,e,r,n,i){this.options=null!=t?t:{},this.indentToken=null!=e?e:"  ",this.newlineToken=null!=r?r:"\n",this.defaultLevel=null!=n?n:0,this.parent=i,this.result=[],this.tagTypes={},this.predictTypes={},this.blocks={}}return t.prototype.defaultTag=Tag,t.prototype.defaultPredict=Predict,t.prototype.setDefaultTag=function(t){return this.defaultTag=t},t.prototype.setDefaultPredict=function(t){return this.defaultPredict=t},t.prototype.registerTag=function(t,e){return this.parent?this.parent.registerTag(t,e):this.tagTypes[t]=e,this},t.prototype.registerPredict=function(t,e){return this.parent?this.parent.registerPredict(t,e):this.predictTypes[t]=e,this},t.prototype.registerBlock=function(t,e){return this.parent?this.parent.registerBlock(t,e):this.blocks[t]=e,this},t.prototype.createTag=function(t,e){var r,n;return this.parent?this.parent.createTag(t,e):(n=t.name,new(r=this.tagTypes[n]||this.defaultTag)(t,e))},t.prototype.createPredict=function(t,e,r){var n;return this.parent?this.parent.createPredict(t,e,r):new(n=this.predictTypes[t]||this.defaultPredict)(e,r)},t.prototype.getBlock=function(t){var e;if(this.parent)return this.parent.getBlock(t);if(e=this.blocks[t],!e)throw new Error("Block "+t+" is not defined");return e},t.prototype.sub=function(e){var r;return r=new t(this.options,this.indentToken,this.newlineToken,e||this.defaultLevel,this)},t.prototype.getIndent=function(t){var e,r,n,i;for(r="",e=n=0,i=t+this.defaultLevel;i>=0?i>n:n>i;e=i>=0?++n:--n)r+=this.indentToken;return r},t.prototype.indent=function(t){var e;return this.indented=!0,e=this.getIndent(t),e.length>0&&this.result.push(e),this},t.prototype.eol=function(){return this.result.push(this.newlineToken),this},t.prototype.push=function(t){return this.result.push(t),this},t.prototype.pop=function(){return this.result.pop(),this},t.prototype.last=function(t){return this.result.slice(-t)},t.prototype.generate=function(t){var e,r,n,i,s;for(i=[],r=0,n=t.length;n>r;r++)e=t[r],s=this.createTag(e,{options:{children:t}}),i.push(s.generate(this));return i},t.prototype.getOutput=function(){return this.parent||"\n"!==this.result[0]||this.result.shift(),this.result.join("")},t}();