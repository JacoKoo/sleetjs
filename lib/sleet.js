var Coffee,Context,Doctype,EmptyTag,Include,Markdown,Predict,Tag,Transformer,Uglify,compile,defaultTags,emptyTags,parser;parser=require("./parser"),Tag=require("./tags/tag").Tag,EmptyTag=require("./tags/empty-tag").EmptyTag,Predict=require("./tags/predict").Predict,Doctype=require("./tags/doctype").Doctype,Include=require("./tags/include").Include,Coffee=require("./tags/transformers/coffee").Coffee,Uglify=require("./tags/transformers/uglify").Uglify,Markdown=require("./tags/transformers/markdown").Markdown,Transformer=require("./tags/transformers/transformer").Transformer,Context=function(){function e(e,t,r){this.indentToken=null!=e?e:"  ",this.newlineToken=null!=t?t:"\n",this.defaultLevel=null!=r?r:0,this.result=[],this.tagTypes={},this.predictTypes={}}return e.prototype.sub=function(t){var r;return r=new e(this.indentToken,this.newlineToken,t||this.defaultLevel),r.tagTypes=this.tagTypes,r.predictTypes=this.predictTypes,r},e.prototype.getIndent=function(e){var t,r,n,i;for(r="",t=n=0,i=e+this.defaultLevel;i>=0?i>n:n>i;t=i>=0?++n:--n)r+=this.indentToken;return r},e.prototype.indent=function(e){return this.result.push(this.getIndent(e)),this},e.prototype.eol=function(){return this.result.push(this.newlineToken),this},e.prototype.push=function(e){return this.result.push(e),this},e.prototype.pop=function(){return this.result.pop(),this},e.prototype.last=function(e){return this.result.slice(-e)},e.prototype.registerTag=function(e,t){return this.tagTypes[e]=t,this},e.prototype.registerPredict=function(e,t){return this.predictTypes[e]=t,this},e.prototype.createTag=function(e,t){var r,n;return n=e.name,new(r=this.tagTypes[n]||Tag)(e,t)},e.prototype.createPredict=function(e,t,r){var n;return new(n=this.predictTypes[e]||Predict)(t,r)},e.prototype.generate=function(e){var t,r,n,i,s;for(s=[],n=0,i=e.length;i>n;n++)t=e[n],r=this.createTag(t),s.push(r.generate(this));return s},e.prototype.getOutput=function(){return this.result.join("")},e}(),emptyTags=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],defaultTags={doctype:Doctype,coffee:Coffee,uglify:Uglify,markdown:Markdown,"@include":Include},compile=function(e,t){var r,n,i,s,o,a,p,u,g,c,f,l;null==t&&(t={});try{c=parser.parse(e),a=c.tags,i=c.indent}catch(y){throw n=y,n instanceof parser.SyntaxError?new Error(n.message+" [line: "+n.line+", column: "+n.column+"]"):n}for(r=new Context(i),u=0,g=emptyTags.length;g>u;u++)s=emptyTags[u],r.registerTag(s,EmptyTag);for(o in defaultTags)p=defaultTags[o],r.registerTag(o,p);f=t.tags||{};for(o in f)p=f[o],r.registerTag(o,p);l=t.predicts||{};for(o in l)p=l[o],r.registerPredict(o,p);return r.generate(a),r.getOutput()},module.exports={compile:compile,Tag:Tag,EmptyTag:EmptyTag,Predict:Predict,Transformer:Transformer};