var Coffee,Context,Doctype,EmptyTag,Include,Markdown,Predict,Tag,Uglify,defaultTags,emptyTags,parser;parser=require("./parser"),Tag=require("./tags/tag").Tag,EmptyTag=require("./tags/empty-tag").EmptyTag,Predict=require("./tags/predict").Predict,Doctype=require("./tags/doctype").Doctype,Include=require("./tags/include").Include,Coffee=require("./tags/transformers/coffee").Coffee,Uglify=require("./tags/transformers/uglify").Uglify,Markdown=require("./tags/transformers/markdown").Markdown,Context=function(){function e(e,t,r){this.indentToken=null!=e?e:"  ",this.newlineToken=null!=t?t:"\n",this.defaultLevel=null!=r?r:0,this.result=[],this.tagTypes={},this.predictTypes={}}return e.prototype.sub=function(t){var r;return r=new e(this.indentToken,this.newlineToken,t||this.defaultLevel),r.tagTypes=this.tagTypes,r.predictTypes=this.predictTypes,r},e.prototype.getIndent=function(e){var t,r,n,i;for(r="",t=n=0,i=e+this.defaultLevel;i>=0?i>n:n>i;t=i>=0?++n:--n)r+=this.indentToken;return r},e.prototype.indent=function(e){return this.result.push(this.getIndent(e)),this},e.prototype.eol=function(){return this.result.push(this.newlineToken),this},e.prototype.push=function(e){return this.result.push(e),this},e.prototype.pop=function(){return this.result.pop(),this},e.prototype.last=function(e){return this.result.slice(-e)},e.prototype.registerTag=function(e,t){return this.tagTypes[e]=t,this},e.prototype.registerPredict=function(e,t){return this.predictTypes[e]=t,this},e.prototype.createTag=function(e,t){var r,n;return n=e.name,new(r=this.tagTypes[n]||Tag)(e,t)},e.prototype.createPredict=function(e,t,r){var n;return new(n=this.predictTypes[e]||Predict)(t,r)},e.prototype.generate=function(e){var t,r,n,i,s;for(s=[],n=0,i=e.length;i>n;n++)t=e[n],r=this.createTag(t),s.push(r.generate(this));return s},e.prototype.getOutput=function(){return this.result.join("")},e}(),emptyTags=["input","br","hr","link","img","meta"],defaultTags={doctype:Doctype,coffee:Coffee,uglify:Uglify,markdown:Markdown,"@include":Include},exports.compile=function(e,t){var r,n,i,s,o,p,u,a,g,f,c;for(null==t&&(t={}),g=parser.parse(e),o=g.tags,n=g.indent,r=new Context(n),u=0,a=emptyTags.length;a>u;u++)i=emptyTags[u],r.registerTag(i,EmptyTag);for(s in defaultTags)p=defaultTags[s],r.registerTag(s,p);f=t.tags||{};for(s in f)p=f[s],r.registerTag(s,p);c=t.predicts||{};for(s in c)p=c[s],r.registerPredict(s,p);return r.generate(o),r.getOutput()};