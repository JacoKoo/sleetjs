var BlockDefinition,Tag,extend=function(t,e){function r(){this.constructor=t}for(var i in e)hasProp.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;Tag=require("./tag").Tag,exports.BlockDefinition=BlockDefinition=function(t){function e(t){if(this.options=t,this.name=this.options.hash,!this.name)throw new Erorr("Hash property is required for block definition. eg. @block#name");if(this.indent=this.options.indent,0!==this.indent)throw new Error("Block definition must be placed in top level(the indent of it must be 0)");this.attributeGroup=this.options.attributeGroups.length>0?this.options.attributeGroups[0]:{attributes:[]}}return extend(e,t),e.prototype.generate=function(t){return t.registerBlock(this.name,this),this.attributes=this.getAttributes(t,this.attributeGroup)},e.prototype.generateBlock=function(t,e){var r,i,o,n,s,u,p,a,h,c,g;for(c=t.sub(e.indent-1),a=this.options.children,o=0,u=a.length;u>o;o++)n=a[o],c.createTag(n,this).generate(c);i=c.getOutput(),r=e.attributeGroup?this.getAttributes(t,e.attributeGroup):{},p={},h=this.attributes;for(s in h)g=h[s],p[s]=r[s]||g;return i=this.processReplacement(i,p),t.push(i)},e.prototype.getAttributes=function(t,e){var r,i,o,n,s,u;for(s=t.sub(),u={attributeGroups:[e]},s.createTag(u).generateAttributes(s),n=/([a-zA-Z$@_][a-zA-Z0-9$@_.-]*)\s*=\s*('([^']*)'|"([^"]*)")/g,i=s.getOutput(),r={};o=n.exec(i);)r[o[1]]=o[3]||o[4];return r},e.prototype.processReplacement=function(t,e){var r,i,o;for(r in e)o=e[r],i=new RegExp("\\$"+r,"g"),t=t.replace(i,o);return t},e}(Tag);