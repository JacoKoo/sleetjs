var Tag,isArray,isString,toString;toString=Object.prototype.toString,isString=function(t){return"[object String]"===toString.call(t)},isArray=function(t){return"[object Array]"===toString.call(t)},exports.Tag=Tag=function(){function t(t,e){var n,i,r,s;for(this.options=t,this.parent=null!=e?e:{},this.attributes=[],this.content=this.options.text||"",this.name=this.options.name||"div",this.indent=this.options.indent||0,this.options.hash&&this.setAttribute("id",this.options.hash),s=this.options.dot,i=0,r=s.length;r>i;i++)n=s[i],this.setAttribute("class",n);this.attributeGroups=this.options.attributeGroups,this.children=this.options.children,this.haveInlineChild=!1,this.isInline=this.indent===this.parent.indent,this.parent.haveInlineChild=this.isInline}return t.prototype.isString=isString,t.prototype.isArray=isArray,t.prototype.setAttribute=function(t,e){var n,i,r,s,o;for(isString(t)&&(t={value:t,type:"identifier"}),null===e&&(e=[]),isString(e)&&(e=[{value:e,type:"quoted"}]),o=this.attributes,r=0,s=o.length;s>r;r++)i=o[r],i.name.value===t.value&&i.name.type===t.type&&(n=i);return n?n.value=n.value.concat(e):this.attributes.push({name:t,value:e})},t.prototype.generate=function(t){return this.generateOpenStart(t),this.generateAttributes(t),this.generateOpenEnd(t),this.generateContent(t),this.generateClose(t)},t.prototype.generateOpenStart=function(t){return this.isInline?t.pop():t.indent(this.indent),t.push("<").push(this.name)},t.prototype.generateAttributes=function(t){var e,n,i,r,s,o,h,u,a,p,l,g;for(a=this.attributeGroups,i=0,o=a.length;o>i;i++)if(e=a[i],e.predict)n=t.createPredict(e.predict.name,e,this),n.generate(t);else for(p=e.attributes,r=0,h=p.length;h>r;r++)e=p[r],this.setAttribute(e.name,e.value);for(l=this.attributes,g=[],s=0,u=l.length;u>s;s++)e=l[s],g.push(this.generateAttribute(e,t));return g},t.prototype.generateAttribute=function(t,e){var n,i,r;return i=t.name,r=t.value,r||(r=[]),e.push(" ").push(i.value),"class"===i.value?e.push('="').push(function(){var t,e,i;for(i=[],t=0,e=r.length;e>t;t++)n=r[t],i.push(n.value);return i}().join(" ")).push('"'):(0===r.length&&r.push(i),e.push('="').push(function(){var t,e,i;for(i=[],t=0,e=r.length;e>t;t++)n=r[t],i.push(n.value);return i}().join("")).push('"'))},t.prototype.generateOpenEnd=function(t){return t.push(this.selfClosing()?"/>":">"),this.needNewLineTokenAfterTagOpen()||this.selfClosing()?t.eol():void 0},t.prototype.needNewLineTokenAfterTagOpen=function(){return this.children.length>0?!0:isArray(this.content)?!0:!1},t.prototype.needTextIndent=function(){return this.needNewLineTokenAfterTagOpen()&&isString(this.content)},t.prototype.selfClosing=function(){return!1},t.prototype.generateContent=function(t){var e,n,i,r,s;for(this.content&&(this.needTextIndent()&&t.indent(this.indent+1),t.push(isString(this.content)?this.content:this.content.join(t.newlineToken)),(this.needTextIndent()||isArray(this.content))&&t.eol()),r=this.children,s=[],n=0,i=r.length;i>n;n++)e=r[n],s.push(isString(e)?t.push(e).eol():t.createTag(e,this).generate(t));return s},t.prototype.generateClose=function(t){return this.selfClosing()?void 0:(this.needNewLineTokenAfterTagOpen()&&!this.haveInlineChild&&t.indent(this.indent),this.haveInlineChild&&t.pop(),t.push("</").push(this.name).push(">").eol())},t}();