var Tag,isArray,isString,toString;toString=Object.prototype.toString,isString=function(t){return"[object String]"===toString.call(t)},isArray=function(t){return"[object Array]"===toString.call(t)},exports.Tag=Tag=function(){function t(t,e){var n,i,r,s;for(this.options=t,this.parent=null!=e?e:{},this.attributes={},this.content=options.text||"",this.name=options.name||"div",this.indent=options.indent||0,options.hash&&this.setAttribute("id",options.hash),s=options.dot,i=0,r=s.length;r>i;i++)n=s[i],this.setAttribute("class",n);this.attributeGroups=options.attributeGroups,this.children=options.children,this.haveInlineChild=!1,this.isInline=this.indent===this.parent.indent,this.parent.haveInlineChild=this.isInline}return t.prototype.isString=isString,t.prototype.isArray=isArray,t.prototype.setAttribute=function(t,e){return"clazz"===t||"class"===t?this.attributes["class"]?this.attributes["class"]+=" "+e:this.attributes["class"]=e:this.attributes[t]=e},t.prototype.generate=function(t){return this.generateOpenStart(t),this.generateAttributes(t),this.generateOpenEnd(t),this.generateContent(t),this.generateClose(t)},t.prototype.generateOpenStart=function(t){return this.isInline?t.pop():t.indent(this.indent),t.push("<").push(this.name)},t.prototype.generateAttributes=function(t){var e,n,i,r,s,o,h,a,p,u,c,g,l;for(r=[],u=this.attributeGroups,o=0,a=u.length;a>o;o++)if(e=u[o],e.predict)r.push(e);else{c=e.attributes;for(n in c)s=c[n],this.setAttribute(n,s)}for(h=0,p=r.length;p>h;h++)e=r[h],i=t.createPredict(e.predict.name,e,this),i.generate(t);g=this.attributes,l=[];for(n in g)s=g[n],l.push(this.generateAttribute(n,s,t));return l},t.prototype.generateAttribute=function(t,e,n){return n.push(" ").push(t).push('="').push(e).push('"')},t.prototype.generateOpenEnd=function(t){return t.push(this.haveContent()?">":"/>"),this.needNewLineTokenAfterTagOpen()||!this.haveContent()?t.eol():void 0},t.prototype.needNewLineTokenAfterTagOpen=function(){return this.children.length>0?!0:isArray(this.content)?!0:!1},t.prototype.needTextIndent=function(){return this.needNewLineTokenAfterTagOpen()&&isString(this.content)},t.prototype.haveContent=function(){return!!this.content||0!==this.children.length},t.prototype.generateContent=function(t){var e,n,i,r,s;for(this.content&&(this.needTextIndent()&&t.indent(this.indent+1),t.push(isString(this.content)?this.content:this.content.join(t.newlineToken)),(this.needTextIndent()||isArray(this.content))&&t.eol()),r=this.children,s=[],n=0,i=r.length;i>n;n++)e=r[n],s.push(isString(e)?t.push(e).eol():t.createTag(e,this).generate(t));return s},t.prototype.generateClose=function(t){return this.haveContent()?(this.needNewLineTokenAfterTagOpen()&&!this.haveInlineChild&&t.indent(this.indent),this.haveInlineChild&&t.pop(),t.push("</").push(this.name).push(">").eol()):void 0},t}();