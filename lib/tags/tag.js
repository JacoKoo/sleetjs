var Tag,isArray,isString,toString;toString=Object.prototype.toString,isString=function(t){return"[object String]"===toString.call(t)},isArray=function(t){return"[object Array]"===toString.call(t)},exports.Tag=Tag=function(){function t(t,e){var n,i,r,s;for(this.options=t,this.parent=null!=e?e:{},this.attributes=[],this.name=this.options.name||"div",this.indent=this.options.indent||0,this.options.hash&&this.setAttribute("id",this.options.hash),s=this.options.dot,i=0,r=s.length;r>i;i++)n=s[i],this.setAttribute("class",n);this.attributeGroups=this.options.attributeGroups,this.children=this.options.children}return t.prototype.isString=isString,t.prototype.isArray=isArray,t.prototype.setAttribute=function(t,e){var n,i,r,s,o;for(isString(t)&&(t={value:t,type:"identifier"}),isString(e)&&(e=[{value:e,type:"quoted"}]),o=this.attributes,r=0,s=o.length;s>r;r++)i=o[r],i.name.value===t.value&&i.name.type===t.type&&(n=i);return n?n.value=n.value.concat(e):this.attributes.push({name:t,value:e})},t.prototype.generate=function(t){return this.childrenContext=t.sub(),this.generateOpenStart(t),this.generateAttributes(t),this.generateOpenEnd(t),this.generateContent(this.childrenContext),t.push(this.childrenContext.getOutput()),this.generateClose(t)},t.prototype.generateOpenStart=function(t){return this.generateStartIndent(t),this.generateTagStart(t)},t.prototype.generateStartIndent=function(t){return this.options.isInlineChild||this.options.isInlineSibling?void 0:t.eol().indent(this.indent)},t.prototype.generateTagStart=function(t){return t.push("<").push(this.name)},t.prototype.generateAttributes=function(t){var e,n,i,r,s,o,u,a,h,p,g,l,c;for(p=this.attributeGroups,i=0,o=p.length;o>i;i++)if(n=p[i],n.predict)h=t.createPredict(n.predict.name,n,this),h.generate(t);else for(g=n.attributes,r=0,u=g.length;u>r;r++)e=g[r],this.setAttribute(e.name,e.value);for(l=this.attributes,c=[],s=0,a=l.length;a>s;s++)n=l[s],c.push(this.generateAttribute(n,t));return c},t.prototype.generateAttribute=function(t,e){var n,i,r;return i=t.name,r=t.value,e.push(" ").push(i.value),"class"===i.value?e.push('="').push(function(){var t,e,i;for(i=[],t=0,e=r.length;e>t;t++)n=r[t],i.push(n.value);return i}().join(" ")).push('"'):(0===r.length&&r.push(i),e.push('="').push(function(){var t,e,i;for(i=[],t=0,e=r.length;e>t;t++)n=r[t],i.push(n.value);return i}().join("")).push('"'))},t.prototype.generateOpenEnd=function(t){return t.push(this.selfClosing()?"/>":">")},t.prototype.selfClosing=function(){return!1},t.prototype.generateContent=function(t){var e,n,i,r,s;for(r=this.children,s=[],n=0,i=r.length;i>n;n++)e=r[n],s.push(t.createTag(e,this).generate(t));return s},t.prototype.generateClose=function(t){return this.selfClosing()?void 0:(this.childrenContext.indented&&!this.options.haveInlineChild&&t.eol().indent(this.indent),this.generateTagEnd(t))},t.prototype.generateTagEnd=function(t){return t.push("</").push(this.name).push(">")},t}();